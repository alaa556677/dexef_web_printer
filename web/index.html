<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebPrint Agent - Web Demo</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .info-box {
            background: #e8f4fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            font-size: 14px;
        }
        .btn-primary { background: #3498db; }
        .btn-success { background: #27ae60; }
        .btn-warning { background: #e67e22; }
        .results {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            min-height: 200px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-x: auto;
            margin-bottom: 30px;
        }
        .help-box {
            background: #fff3cd;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }
        .status-connected { color: #27ae60; }
        .status-failed { color: #e74c3c; }
        .status-testing { color: #f39c12; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">üñ®Ô∏è WebPrint Agent - Web Demo</h1>
        
        <div class="info-box">
            <h3 style="margin-top: 0; color: #2980b9;">‚ÑπÔ∏è Web Demo Information</h3>
            <p style="margin: 10px 0;">This is a web demonstration of the WebPrint Agent Dart package. The examples below show simulated API responses to demonstrate how the package would work in a real Flutter web application.</p>
            <p style="margin: 10px 0;"><strong>Note:</strong> This demo uses simulated data. In a real application, you would connect to an actual WebPrint Agent server.</p>
        </div>

        <div class="grid">
            <div class="card">
                <h3 style="margin-top: 0; color: #2c3e50;">üîß Configuration</h3>
                <p><strong>Base URL:</strong> <span id="baseUrl">http://127.0.0.1:5123</span></p>
                <p><strong>API Key:</strong> <span id="apiKey">49a65c3e-3fa6-436a-9376-b5daff101491</span></p>
                <p><strong>Status:</strong> <span id="connectionStatus" class="status-testing">Testing...</span></p>
            </div>
            
                    <div class="card">
            <h3 style="margin-top: 0; color: #2c3e50;">üìä Quick Actions</h3>
            <button id="testConnectionBtn" class="button btn-primary">Test Connection</button>
            <button id="checkHealthBtn" class="button btn-success">Check Health</button>
            <button id="listPrintersBtn" class="button btn-warning">List Printers</button>
            <button id="printPdfBtn" class="button btn-info" style="background: #9b59b6;">Print PDF</button>
        </div>
        </div>

        <div>
            <h3 style="color: #2c3e50;">üìã Results</h3>
            <div id="results" class="results">
                Click a button above to see results...
            </div>
        </div>

        <div class="help-box">
            <h3 style="margin-top: 0; color: #856404;">üí° How to Use in Flutter Web</h3>
            <p style="margin: 10px 0;">To use this package in a real Flutter web application:</p>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li>Add <code>webprint_agent: ^1.0.0</code> to your <code>pubspec.yaml</code></li>
                <li>Import the package: <code>import 'package:webprint_agent/webprint_agent.dart';</code></li>
                <li>Create a client instance with your API key</li>
                <li>Use the client methods to interact with your WebPrint Agent server</li>
            </ol>
        </div>
    </div>

    <script>
        // Real WebPrint Agent client for web demonstration
        class WebPrintAgentClient {
            constructor(apiKey, baseUrl = 'http://127.0.0.1:5123') {
                this.apiKey = apiKey;
                this.baseUrl = baseUrl;
            }

            // Real health check
            async checkHealth() {
                const response = await fetch(`${this.baseUrl}/health`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return await response.json();
            }

            // Real listing printers
            async listPrinters() {
                const response = await fetch(`${this.baseUrl}/printers`, {
                    headers: {
                        'X-API-Key': this.apiKey
                    }
                });
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return await response.json();
            }

            // Simulate getting default printer
            async getDefaultPrinter() {
                await new Promise(resolve => setTimeout(resolve, 200));
                
                return {
                    name: 'HP LaserJet Pro (Web Demo)',
                    portName: 'WEB001',
                    ipAddress: '192.168.1.100',
                    driverName: 'HP LaserJet Pro',
                    location: 'Office',
                };
            }

            // Simulate getting print jobs
            async getPrintJobs(limit) {
                await new Promise(resolve => setTimeout(resolve, 400));
                
                const jobs = [
                    {
                        id: 'web-job-001',
                        timestamp: Date.now() - 300000, // 5 minutes ago
                        printer: 'HP LaserJet Pro (Web Demo)',
                        filename: 'document.pdf',
                        status: 'success',
                    },
                    {
                        id: 'web-job-002',
                        timestamp: Date.now() - 3600000, // 1 hour ago
                        printer: 'HP LaserJet Pro (Web Demo)',
                        filename: 'report.pdf',
                        status: 'success',
                    },
                    {
                        id: 'web-job-003',
                        timestamp: Date.now() - 7200000, // 2 hours ago
                        printer: 'Canon Printer (Web Demo)',
                        filename: 'test.pdf',
                        status: 'error',
                        error: 'Printer offline (Web Demo)',
                    },
                ];
                
                if (limit && limit < jobs.length) {
                    return jobs.slice(0, limit);
                }
                return jobs;
            }

            // Test connection
            async testConnection() {
                try {
                    await this.checkHealth();
                    return true;
                } catch (e) {
                    return false;
                }
            }
        }

        // Initialize the client
        const client = new WebPrintAgentClient('49a65c3e-3fa6-436a-9376-b5daff101491');

        // Set up event listeners
        document.getElementById('testConnectionBtn').addEventListener('click', () => {
            testConnection();
        });

        document.getElementById('checkHealthBtn').addEventListener('click', () => {
            checkHealth();
        });

        document.getElementById('listPrintersBtn').addEventListener('click', () => {
            listPrinters();
        });

        document.getElementById('printPdfBtn').addEventListener('click', () => {
            printPdf();
        });

        // Test connection to the WebPrint Agent
        async function testConnection() {
            updateResults('Testing connection to WebPrint Agent...\n');
            updateConnectionStatus('Testing...', 'testing');
            
            try {
                const isConnected = await client.testConnection();
                if (isConnected) {
                    updateResults('‚úÖ Connection successful! WebPrint Agent is accessible.\n');
                    updateConnectionStatus('Connected', 'connected');
                } else {
                    updateResults('‚ùå Connection failed. WebPrint Agent is not accessible.\n');
                    updateConnectionStatus('Failed', 'failed');
                }
            } catch (e) {
                updateResults('‚ùå Connection error: ' + e + '\n');
                updateConnectionStatus('Error', 'failed');
            }
        }

        // Check health status
        async function checkHealth() {
            updateResults('Checking health status...\n');
            
            try {
                const health = await client.checkHealth();
                updateResults(`‚úÖ Health check successful!

Status: ${health.status}
Version: ${health.version}
OS: ${health.os}
Architecture: ${health.arch}
Uptime: ${health.uptime.toFixed(1)}s
Memory Usage:
  RSS: ${(health.memory.rss / (1024 * 1024)).toFixed(2)}MB
  Heap Total: ${(health.memory.heapTotal / (1024 * 1024)).toFixed(2)}MB
  Heap Used: ${(health.memory.heapUsed / (1024 * 1024)).toFixed(2)}MB
  External: ${(health.memory.external / (1024 * 1024)).toFixed(2)}MB
  Array Buffers: ${(health.memory.arrayBuffers / (1024 * 1024)).toFixed(2)}MB

`);
            } catch (e) {
                updateResults('‚ùå Health check failed: ' + e + '\n');
            }
        }

        // List available printers
        async function listPrinters() {
            updateResults('Listing available printers...\n');
            
            try {
                const printers = await client.listPrinters();
                let result = `‚úÖ Found ${printers.length} printer(s):\n\n`;
                
                printers.forEach(printer => {
                    result += `üñ®Ô∏è  ${printer.name}\n`;
                    result += `    Port: ${printer.portName || 'N/A'}\n`;
                    result += `    Driver: ${printer.driverName || 'N/A'}\n`;
                    result += `    Location: ${printer.location || 'N/A'}\n`;
                    result += `    IP: ${printer.ipAddress || 'N/A'}\n`;
                    result += `    Comment: ${printer.comment || 'N/A'}\n\n`;
                });
                
                updateResults(result);
            } catch (e) {
                updateResults('‚ùå Failed to list printers: ' + e + '\n');
            }
        }

        // Print PDF
        async function printPdf() {
            updateResults('Printing PDF...\n');
            
            try {
                // Create a sample PDF (this is just for demo purposes)
                // In a real app, you would get this from a file input or generate it
                const samplePdfData = new Uint8Array([
                    0x25, 0x50, 0x44, 0x46, 0x2D, 0x31, 0x2E, 0x34, 0x0A, 0x25, 0xC7, 0xEC, 0x8F, 0xA2, 0x0A
                ]);
                
                const formData = new FormData();
                formData.append('file', new Blob([samplePdfData], { type: 'application/pdf' }), 'sample.pdf');
                
                const response = await fetch(`${client.baseUrl}/print`, {
                    method: 'POST',
                    headers: {
                        'X-API-Key': client.apiKey
                    },
                    body: formData
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP ${response.status}: ${errorData.error || response.statusText}`);
                }
                
                const result = await response.json();
                updateResults(`‚úÖ PDF printed successfully!\n\nJob ID: ${result.jobId || 'N/A'}\nPrinter: ${result.printer || 'Default'}\nFilename: ${result.filename || 'sample.pdf'}\nStatus: ${result.status || 'queued'}\n`);
                
            } catch (e) {
                updateResults('‚ùå Failed to print PDF: ' + e + '\n');
            }
        }

        // Update the results display
        function updateResults(text) {
            document.getElementById('results').textContent = text;
        }

        // Update the connection status
        function updateConnectionStatus(status, className) {
            const statusElement = document.getElementById('connectionStatus');
            statusElement.textContent = status;
            statusElement.className = `status-${className}`;
        }

        // Initial connection test
        testConnection();
    </script>
</body>
</html>
